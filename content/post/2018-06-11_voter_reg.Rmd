---
title: "Voter Registration"
author: "Joe Ciesielski"
date: "6/11/2018"
output: html_document
draft: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

library(tidyverse)
library(readxl)
library(here)
library(tidycensus)
library(stringr)

fix_names <- function(x) {
  names(x) <- tolower(make.names(names(x)))
  names(x) <- str_replace_all(names(x), "[/.]+", "_")
  x
}

# state voter registration and voting info
state <- "data/table04a.xls" %>% 
  here::here() %>% 
  read_excel(skip = 4) %>% 
  rename(state = X__1,
         total_pop = X__2,
         total_citizens = X__3) %>% 
  slice(2:52) %>% 
  mutate(state = tolower(state)) %>% 
  fix_names()

# educational characteristics
educ_vars <- c(total_pop = "B23006_001",
               bach_or_higher = "B23006_023")
               
educ <- get_acs(geography = "state", variables = educ_vars) %>% 
  select(-moe) %>% 
  spread(variable, estimate) %>% 
  mutate(pct_bach = bach_or_higher / total_pop,
         state = tolower(NAME))

state_chars <- left_join(state, educ, by = "state")

```



```{r}

ggplot(state_chars, aes(pct_bach, percent_registered_total_)) +
  geom_point() +
  geom_smooth(method = "glm") +
  geom_label(aes(label = state))

```

