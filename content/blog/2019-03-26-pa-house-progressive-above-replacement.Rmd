---
title: PA House - Progressive Above Replacement
author: Joseph Ciesielski
date: '2019-03-26'
slug: pa-house-progressive-above-replacement
categories: []
tags: []
comments: no
showcomments: yes
showpagemeta: yes
draft: true
---

```{r}

library(tidyverse)
library(scales)

theme_set(theme_minimal())

```

State legislatures were not immune to the much discussed 'blue wave' of 2018. In Pennsylvania, a number of candidates ran on progressive and far left platfroms and won including Sara Innamoroto, Summer Lee, and Elizabeth Fiedler. 

A few months ago, Data for Progress put out a piece of US House Democrats fared on their '[Progressive above Replacement](https://www.dataforprogress.org/par-scores)' score. They predicted how progressive a Democrat should be based on characteristics of their district; progressive-ness was rated based on votes and co-sponsorships of bills in key progressive issues including public housing, tuition-free college, and renewable energy. 

Given the excitement about some of the far-left candidates for Pennsylvania's State House, I wanted to replicate this approach. 

I also wanted to see if scores on this metrics had any relationship to whether candidates were re-elected (or decided not to run) in 2018. 

## Methodology

I used votes on the following key divisive bills to asses progressiveness:

	- Bill 2154: rolling back regulations on oil and gas drilling
	- Bill 97: charter school reform
	- Bill 2060: taking away guns from domestic abusers
	- Bill 178: allowing teachers to be laid off based on evaluations
	- Bill 1419: expunging criminal records for those with minor offences
	- Bill 27: shielding names of officers involved in shootings
	- Bill 110: imposing limits on spending growth
	- Bill 2017: overturning Department of Revenue ruling disallowing deduction of business expenses
	- Bill 2477: funding medical marijuana research
	- Bill 2138: work requirements for Medicaid
	- Bill 2050: banning abortions for fetuses with Downs Syndrome 

### Data wrangling

We'll use four different data sets for this analysis. I scrpaed each from the web [add links] but saved each to my Github account. Let's read in each one at a time and take a look. 

```{r}

election_results <- read_csv("https://raw.githubusercontent.com/jtcies/jtcies_site/master/content/data/pa-par/election_results.csv")

election_results

```
The first is the results from the 2016 PA House general election. I've already calculated the percent of votes that went for the Democrat. 

```{r}

bills <- read_csv("https://raw.githubusercontent.com/jtcies/jtcies_site/master/content/data/pa-par/pa_house_bills_2017-18.csv")


bills
```

This data shows the bills, the topic, and whether or not a vote for the bill would be considered perspective. Next is how the reps votes on each of those bills ...

```{r}

votes <- read_csv("https://raw.githubusercontent.com/jtcies/jtcies_site/master/content/data/pa-par/bill_votes.csv")

votes
```

... who won the 2018 election (so we can use this as an outcome) ...

```{r}

reps_2018 <- read_csv("https://raw.githubusercontent.com/jtcies/jtcies_site/master/content/data/pa-par/reps_2018.csv")

reps_2018
```

... and a data set with the different name formats so we can combine the election results with the legislative data. 

```{r}

name_recode <- read_csv("https://raw.githubusercontent.com/jtcies/jtcies_site/master/content/data/pa-par/votes_names.csv")

name_recode

```

Phew, ok. Now we can start merging some of the data together. The goal is create a data set that inlcude election results, voting record, and whether someone was still a rep in 2018. 

First pull out the election winners. No independents won in 2016, so that makes this a little easier.

```{r}

election_winners <- election_results %>% 
  mutate(
    representative = case_when(
      district == 142 ~ rep,
      dem_votes > rep_votes ~ dem,
      rep_votes > dem_votes ~ rep,
      dem == "No candidate" ~ rep,
      rep == "No candidate" ~ dem
    ),
    total_votes = dem_votes + rep_votes + indep_votes,
    pct_for = if_else(representative == dem, dem_votes / total_votes, rep_votes / total_votes),
    pct_against = if_else(representative == dem),
    margin = if_else(is.na(margin), 1, margin),
    party = if_else(representative == dem, "Democrat", "Republican")
  ) %>% 
  select(representative, party, district, margin)

election_winners

```

Now we'll get a summary

```{r}

prog_summary <- votes %>% 
   left_join(bills, by = "bill") %>%
    left_join(name_recode, by = c("rep" = "vote_name")) %>% 
    mutate(
      progressive_vote = case_when(
        progressive == 1 & vote == "yay" ~ 1,
        progressive == -1 & vote == "yay" ~ 0,
        progressive == 1 & vote == "nay" ~ 0,
        progressive == -1 & vote == "nay" ~ 1
      )
    ) %>% 
  filter(!is.na(election_name)) %>% 
  group_by(representative = election_name) %>% 
  summarise(progressive_avg = mean(progressive_vote))

```


```{r}

pa_house_tidy <- election_winners %>% 
  left_join(prog_summary, by = "representative") %>% 
  left_join(reps_2018, by = c("representative" = "rep")) %>% 
  replace_na(list(winner = 0))

```


## Visulizing

First let's look at margin of victory by party. We should have 121 Repbublicans and 82 Democrats. 

```{r}

pa_house_tidy %>% 
  count(party)

```

```{r}
pa_house_tidy %>% 
  ggplot(aes(margin, fill = party)) +
    geom_histogram(binwidth = 0.01, show.legend = FALSE) +
    facet_wrap(~party) +
    scale_fill_manual(
      values = c("Democrat" = "blue",
                 "Republican" = "red")
    ) +
    scale_x_continuous(labels = percent_format(1))

```

It looks like both parties had an equal number of wins in uncontested districts, but Democrats had a greater percentage (because they held fewer seats).

```{r}
pa_house_tidy %>%
  group_by(party) %>% 
  summarise(
    `count uncontested` = sum(margin == 1),
    `percent uncontested` = percent(mean(margin ==1))
  ) %>% 
  knitr::kable()
 
```

### Progressiveness by win margin

```{r}

pa_house_tidy %>% 
  ggplot(aes())

```

