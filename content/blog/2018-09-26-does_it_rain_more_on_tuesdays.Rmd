---
title: "Is it more likely to rain on Tuesdays in Philadelphia?"
author: "Joe Ciesielski"
date: "2018-09-26"
output: html_document
draft: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.width = 8, fig.align = "center",
                      fig.asp = 0.618, message = FALSE)
```

Trash days in our neighborhood is on Wednesday, which means we have to put our trash out on Tuesday night. 

```{r}
library(tidyverse)
library(lubridate)
library(rvest)
library(here)

weather <- "data/phl_weather_20090925-20180924.csv" %>% 
  here::here() %>% 
  read_csv()

glimpse(weather)
```

I requested a bunch of variables when I ordered the data initially because I thought some might might be useful in the future. The only two we care about here are `DATE` and `PRCP` which is daily rainfall total in inches. Let's check to make sure we got the dates we requested. 

```{r}
range(weather$DATE)
```

Looks good. Using the `wday` function from the `lubridate` package, we can easily get the day of the week for any date. 

```{r}
weather <- weather %>% 
  mutate(
    day_of_week = wday(DATE, label = TRUE)
  )

count(weather, day_of_week)
```

Looks good. 

## Total rainfall

Let's get a picture of the distribution of rain. 

```{r}

ggplot(weather, aes(x = PRCP)) +
  geom_histogram(binwidth = 0.1)

```

Rainfall totals are highly skewed becuse there is no rain most of the of time. We can log transfrom it to get a better s

```{r}

ggplot(weather, aes(x = day_of_week, y = log(PRCP + 0.0001))) +
  geom_boxplot()

```

Wow! It looks like Tuesday has more days with higher rainfall totals than any other day of the week. We can create a linear model to see how day of the week and rainfall are related. 

```{r}

rain_mod <- lm(
  PRCP ~ as.character(day_of_week),
  data = weather
)

summary(rain_mod)
```

Ok, this tells us that Tuesdays are associated with higher rainfall (about 0.019 inches) compared to our reference day (Friday - first day of the week alphabetically). None of our inputs are even close to significant though. 

## Did it rain at all? 

However, this doesn't really answer the question we were interested in. We don't care too much about the total raint hat fell. Really we want to know if it is more likley to rain at all on Tuesdays. To do this we'll create a binary variable that is 1 if it rained more than 0 inches, and 0 otherwise. 

```{r}

weather <- weather %>% 
  mutate(
    rain = if_else(PRCP > 0, 1L, 0L)
  )

weather %>% 
  group_by(day_of_week) %>% 
  summarise(mean(rain))

```


Wait ... what? It actually does rain more on Tuesdays. By quite a bit. Almost 40% of the time compared to less than 30% of Sundays. 

This time we can use logistic regression to see if this finding is confrimed.

```{r}

binary_mod <- glm(
  rain ~ as.character(day_of_week), 
  family = "binomial",
  data = weather
)

summary(binary_mod)

```

Ok, hang on. This tells us that the log odds of it raining on Tuesday are 0.35 points higher Friday. And that it is significant at the 0.05 level. 

## What's going on here?

I really just wanted to look into this as a joke. It is true that it has rained more on Tuesdays than other day for the past nine years. Does this mean that there is some weather pattern designed to increase my annoyance on trash night? 

